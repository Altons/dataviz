---
myimage1: "DensitySmall.png"
myimage2: "Box1Small.png"
myimage3: "ViolinSmall.png"
myimage4: "HistogramSmall.png"
mydisqus: "10_OneNumSevCatSubgroupSevObsPerGroup"
mytitle: "How much do people tip?"
output:
  html_document:
      self_contained: false    
      mathjax: default
      lib_dir: libs
      template: template_story.html
      theme: "lumen"
      css: style.css
      toc: FALSE
      toc_float: TRUE
      toc_depth: 2
      number_sections: FALSE
      df_print: "paged"
      code_folding: "hide"
      includes: 
        after_body: footer.html
---

<br>
<div class="mycontent">


<div class = "row">
<div class = "col-md-8">
<br><br><br>
This document gives a few suggestions to analyse a dataset composed by a numeric variable measured on groups and subgroups, with several observations for each combinations.
<br><br>
The dataset used as an example describes the amount that restaurant staff receive in tips based on various indicators like the client sex, the day of the week and if the client smokes or not.
<br><br>
Data come from the [Seaborn](https://github.com/mwaskom/seaborn-data) Python library. A clean `.csv` version is available in the data-to-viz.com [github repository](https://github.com/holtzy/data_to_viz/tree/master/Example_dataset).
</div>

<div class = "col-md-4">
<br><br>
```{r, warning=FALSE, message=FALSE}
# Libraries
library(tidyverse)
library(hrbrthemes)
library(kableExtra)
options(knitr.table.format = "html")
library(viridis)
library(ggrepel)
library(plotly)

# Load dataset from github
data <- read.table("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/10_OneNumSevCatSubgroupsSevObs.csv", header=T, sep=",") %>%
  mutate(tip = round(tip/total_bill*100, 1))

# show data
data %>% head(6) %>% select(tip, sex, day, smoker) %>% kable() %>%
  kable_styling(bootstrap_options = "striped", full_width = F)
```
</div>
</div>





#Grouped boxplot
***

```{r, fig.width=8, fig.height=6, fig.align="center", warning=FALSE}
# Counts the number of value per group and subgroup
counts = data %>% 
  group_by(day, sex) %>% 
  summarize(
    n=n(),
    median=median(tip)
  )

# Grouped
data %>%
  mutate(day = fct_reorder(day, tip)) %>%
  mutate(day = factor(day, levels=c("Thur", "Fri", "Sat", "Sun"))) %>%
  ggplot(aes(fill=sex, y=tip, x=day)) + 
    geom_boxplot(position=position_dodge2(preserve = "total"), alpha=0.5, outlier.colour="transparent", varwidth = TRUE) +
    geom_point(color="grey", size=1, width=0.1, position=position_jitterdodge() , alpha=0.4) +
    scale_fill_viridis(discrete=T, name="") +
    geom_text(data=counts, aes(label=paste0("n: ",n), y=median-2), position=position_dodge(0.8), hjust=0.5) +
    theme_ipsum()  +
    xlab("") +
    ylab("Tip (%)") +
    ylim(0,35)
```
The mos


```{r, fig.width=8, fig.height=6, fig.align="center", warning=FALSE}
# Grouped
data %>%
  mutate(day = fct_reorder(day, tip)) %>%
  mutate(day = factor(day, levels=c("Thur", "Fri", "Sat", "Sun"))) %>%
  ggplot(aes(fill=day, y=tip, x=sex)) + 
    geom_boxplot(position="dodge", alpha=0.5, outlier.colour="transparent") +
    geom_point(color="grey", size=1, width=0.1, position=position_jitterdodge() , alpha=0.4) +
    scale_fill_viridis(discrete=T, name="") +
    theme_ipsum()  +
    xlab("") +
    ylab("Tip (%)") +
    ylim(0,40)
```




#Violin
***

```{r, fig.width=8, fig.height=6, fig.align="center", warning=FALSE}
# Grouped
data %>%
  mutate(day = fct_reorder(day, tip)) %>%
  mutate(day = factor(day, levels=c("Thur", "Fri", "Sat", "Sun"))) %>%
  ggplot(aes(fill=sex, y=tip, x=day)) + 
    geom_violin(position="dodge", alpha=0.5, outlier.colour="transparent") +
    scale_fill_viridis(discrete=T, name="") +
    theme_ipsum()  +
    xlab("") +
    ylab("Tip (%)") +
    ylim(0,40)
```






#Histogram
***

```{r, fig.width=8, fig.height=6, fig.align="center", warning=FALSE}
# Grouped
data %>%
  mutate(day = fct_reorder(day, tip)) %>%
  mutate(day = factor(day, levels=c("Thur", "Fri", "Sat", "Sun"))) %>%
  ggplot(aes(x=tip)) + 
    geom_histogram(bins=20, fill="#69b3a2", color="white") +
    facet_grid(sex~time) +
    theme_ipsum()  +
    xlab("") +
    ylab("Tip")
```


#Comments
***
Any thoughts on this? Found any mistake? Disagree? Please drop me a word on [twitter](https://twitter.com/R_Graph_Gallery) or in the comment section below:
<br>

</div>





