---
myimage1: "../img/section/Bar150.png"
myimage2: "../img/section/CircularBarplot150.png"
myimage3: "../img/section/Lollipop150.png"
mytitle: "Who sells more weapons?"
output:
  html_document:
      template: template_story.html
      theme: "lumen"
      css: style.css
      toc: FALSE
      toc_float: TRUE
      toc_depth: 2
      number_sections: TRUE
      df_print: "paged"
      code_folding: "hide"
      includes: 
        after_body: footer.html
---

<br><br>
<div class="mycontent">


<div class = "row">
<div class = "col-md-8">
<br><br><br>
This document gives a few suggestions to analyse a dataset composed by `one numeric and one categoric` variable.
<br>
The dataset used as an example provides the quantity of weapons exported by the top 50 largest exporters in 2017. This dataset has been downloaded on the [Stockholm International Peace Research Institute](http://armstrade.sipri.org/armstrade/page/toplist.php) website and more information about it are available [here](http://www.sipri.org/databases/armstransfers/sources-and-methods/).
<br>
A clean version at `.csv` format is available on github, and the table beside shows how it looks like.
</div>

<div class = "col-md-4">
```{r, warning=FALSE, message=FALSE}
# Libraries
library(tidyverse)
library(hrbrthemes)
library(kableExtra)
options(knitr.table.format = "html")

# Load dataset from github
#data <- read.table("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/7_OneCatOneNum.csv", header=TRUE, sep=",")
data <- read.table("../Example_dataset/7_OneCatOneNum.csv", header=TRUE, sep=",")

# show data
data %>% head(6) %>% kable() %>%
  kable_styling(bootstrap_options = "striped", full_width = F)
```
</div>
</div>










# Option 1: Lollipop
***

Even if the most common way to represent this kind of information is probably to use barplots, lollipop can be a very good alternative, especially if you have a high number of entities. It is basically the same thing, but the bar is replaced by a line and a dot at the end. It allows the figure to be less cluttered.

Moreover, it is a good practice to plot a horizontal version, to make the labels more easily readable. Last, sorting your entities gives much more insight to the plot.
```{r, fig.align="center", fig.height=7}
data %>%
  filter(!is.na(Value)) %>%
  arrange(Value) %>%
  mutate(Country=factor(Country, Country)) %>%
  ggplot( aes(x=Country, y=Value) ) +
    geom_segment( aes(x=Country ,xend=Country, y=0, yend=Value), color="grey") +
    geom_point(size=3, color="#69b3a2") +
    coord_flip() +
    theme_ipsum() +
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="none"
    ) +
    xlab("")
```

#- Barplot
***

Here is the barplot version that looks very similar to the lollipop. This version is all right in this case where there is a lot of difference from one bar to the other. It would look way to cluttered with no or few differences.
```{r, fig.align="center", fig.height=7}
data %>%
  filter(!is.na(Value)) %>%
  arrange(Value) %>%
  mutate(Country=factor(Country, Country)) %>%
  ggplot( aes(x=Country, y=Value) ) +
    geom_bar(stat="identity", fill="#69b3a2") +
    coord_flip() +
    theme_ipsum() +
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="none"
    ) +
    xlab("")
```


#- Circular barplot
***

```{r, fig.align="center", fig.height=7}
data %>%
  filter(!is.na(Value)) %>%
  arrange(Value) %>%
  mutate(Country=factor(Country, Country)) %>%
  ggplot( aes(x=Country, y=Value) ) +
    geom_bar(stat="identity", fill="#69b3a2") +
    coord_flip() +
    theme_ipsum() +
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      panel.grid.major.x = element_blank(),
      legend.position="none"
    ) +
    xlab("") +
    coord_polar() +
    ylim(-7000,13000)
```






#- Treemap
***
A treemap represents each entity as a rectangle, with an area that is proportional to the numeric variable of the dataset.  
It is a good way to show a general overview of the data organization and is probably more eye-catching than the previous barplot. However, it is less precise in the sense that it is harder to make accurate comparisons between groups.
```{r, fig.align="center", fig.width=9}
# Package
library(treemap)

# Plot
treemap(data,
            
            # data
            index="Country",
            vSize="Value",
            type="index",
            
            # Main
            title="",
            palette="Dark2",

            # Borders:
            border.col=c("black"),             
            border.lwds=1,                         
        
            # Labels
            fontsize.labels=0.5,
            fontcolor.labels="white",
            fontface.labels=1,            
            bg.labels=c("transparent"),              
            align.labels=c("left", "top"),                                  
            overlap.labels=0.5,
            inflate.labels=T                        # If true, labels are bigger when rectangle is bigger.

            
            )
```


# Circle packing
***

Circle packing is the circular version of the treemap. Each groupd is represented as a circle instead of a rectangle, and its area is proportional to the numeric value.

```{r, fig.align="center", fig.width=6, fig.height=6, warning=FALSE, message=FALSE}
# Libraries
library(ggraph)
library(igraph)
library(tidyverse)
library(viridis)
 
# We need a data frame giving a hierarchical structure. Let's consider the flare dataset:
tmp <- data %>% filter(!is.na(Value))
edges <- data.frame(
  from = "o",
  to = tmp$Country
)
vertices = rbind(tmp, data.frame(Country="o", Value=1)) %>% mutate(name=Country)
mygraph <- graph_from_data_frame( edges, vertices=vertices )

ggraph(mygraph, layout = 'circlepack', weight="Value") + 
  geom_node_circle( aes(fill=name)) +
  scale_fill_viridis(discrete=TRUE) +
  geom_node_label(aes(label=name, size=Value)) +
  theme_void() +
  theme(
    legend.position="none"
  )



```





</div>














